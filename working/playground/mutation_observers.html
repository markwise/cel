<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Untitled</title>
	
	<style>
	    .a, .b {
	        display:inline-block;
	    }
	    
	    .a {
	        background:red;
	    }
	    
	    .b {
	        background:green;
	    }
	        
	
	    
	
	</style>
	
	
</head>
<body>

    <div id="test"></div>
    
    <button type="button" id="add">Add</button>

    <script>
        /*
        MutationObserver
        
        SA5
        iOS4.2
        IE8+
        FF14
        CH18
        */
    
    
        var test = document.getElementById('test');
        //console.log(test);
    
        // select the target node
        var target = document.body;
        //console.log(target);
 
        var remove_whitespace = function (node) {
            var a = node.childNodes;
            var i = a.length;
            var item;
            
            while (i--) {
                item = a[i];
                
                if (item.nodeType === 3) {
                    node.removeChild(item);
                }
            }
        };
 
 
        // create an observer instance
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                var a = mutation.addedNodes
                var i = a.length;
                var node;
                
                while (i--) {
                    node = a[i];
                    console.log(node);
                    
                    if (node.nodeType === 1) {
                        remove_whitespace(node);
                    
                    
                        if (node.classList.contains('split')) {
                            //console.log(node);
                            //remove whitespace
                            //init cel lines
                            //init responds to elements
                            //equal heights
                        } 
                    } 
                }
        
            
            });    
        });
 
        // configuration of the observer:
        //var config = { attributes: true, childList: true, characterData: true };
        //var config = {childList : true, attributes : true, subtree : true}
        var config = {childList : true, subtree : true};
 
        // pass in the target node, as well as the observer options
        observer.observe(target, config);
 
        // later, you can stop observing
        //observer.disconnect();
    
        test.innerHTML = '<span>mark</span><div id="test2" class="split">some div</div>'
        //test.appendChild(document.createTextNode('lkjasdf'));
        
        
        var split = document.getElementsByClassName('split');
        
        document.getElementById('add').addEventListener('click', function () {
            //console.log(split);
            var test2 = document.getElementById('test2');
            
            //test2.innerHTML = 'test2';
            
            //var ele = document.createElement('div');
            //ele.appendChild(document.createTextNode('adsf'));
            
            //test2.appendChild(ele);
            
            test2.innerHTML = [
                '<div> \n\r\t',
                    '<div class="a"> \n\r\t',
                        'a \n\r\t',
                        '<div> \n\r\t',
                            '<div class="a">a</div> \n\r\t',
                            '<div class="b">b</div> \n\r\t',
                        '</div>',
                    '</div> \n\r\t',
                    '<div class="b"> \n\r\t',
                        'b \n\r\t',
                        '<div> \n\r\t',
                            '<div class="a">a</div> \n\r\t',
                            '<div class="b">b</div> \n\r\t',
                        '</div>',
                    '</div> \n\r\t',
                '</div> '
            ].join('');
            
        
        });
        
        
        
    
    </script>


</body>
</html>
